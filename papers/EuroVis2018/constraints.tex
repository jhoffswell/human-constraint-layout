%!TEX root = constraint-layout.tex
\section{\projectname Constraints and WebCoLa Implementation}
\label{sec:constraints}
We implemented seven constraints for \projectname: 
\texttt{alignment}, \texttt{position}, \texttt{order}, \texttt{circle},
\texttt{cluster}, \texttt{hull}, and \texttt{padding}. In this work, we
target  Dwyer et al.'s WebCoLa library \cite{WebCoLa} in order to support
interactive, web-based layouts. In this section, we describe the requirements 
for each type of constraint and how we implemented them using WebCoLa. 
In WebCoLa, constraints are defined based on the \texttt{\_id} of the
node in the graph specification. We leverage two of WebCoLa's
constraint types for our implementation: \emph{alignment} constraints 
and \emph{position} constraints. For other \projectname constraints, we
approximate the behavior using additional edges or by applying padding
to the nodes in the layout.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Alignment Constraints}
\constraint{\texttt{align} \emph{x} \texttt{axis}}
Alignment constraints ensure that all nodes in the set share one of their
coordinates. For this implementation, the constraint must specify the \texttt{axis}
as either \texttt{x} or \texttt{y}. These constraints are defined as:

\begin{definition}
Let $S$ be the set on which the constraint \texttt{align x axis} is applied.
For all nodes $n_1$ and $n_2$ in $S$ such that $n_1 != n_2$, we define 
a constraint such that $n_1[y]$ == $n_2[y]$.
\end{definition}

\todo{Is it helpful to have a description like this? Is there a better way
to write this up?}

The user may also optionally identify an \texttt{orientation} for the alignment.
The orientation is useful for producing alignments when the size of the 
elements do not match. By default, the orientation is defined as \texttt{center} 
with the behavior described above. When the axis is defined as \texttt{x} 
the user may specify either \texttt{top} or \texttt{bottom} which introduces 
an offset to align the top or bottom of the nodes. For \texttt{y} axis
alignment, the user may specify either \texttt{right} or \texttt{left}.

\emph{Implementation.}
Alignment constraints are one of the constraint types natively supported in
WebCoLa. The WebCoLa alignment constraint takes the \texttt{\_id} of all nodes
that should be aligned and offsets for each node that enable changes to the
alignment orientation of the nodes.

\emph{Rationale.} Support for alignment on either the x or y axis allows
users to produce layouts that exhibit grid like layout properties similar
to those produced by Kieffer et al.\ \cite{kieffer2016hola}.

%\jheer{Why only x/y axes? Why not polar coordinates, for example? Or along arbitrary line segments defined as guides? I'm not saying you *should* support these, only that it's not clear why you focus where you do. Also I don't totally understand what alignment means here (nor what the default would be if unspecified). Readers may be confused about what you mean by applied to nodes vs. applied to sets, as earlier we talk about sets as the units that constraints are applied to. Also, centroid or boundary, which is used when and why?}

% When applied to sets, this constraint produces an alignment based on the centroid or boundary of the set elements.
% \todo{We don't really have alignment working on set elements, only on node elements.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Position Constraints}
\constraint{\texttt{position} \emph{right} \texttt{of} \emph{``top\_guide''}}
Position constraints ensure that all nodes in the set are positioned relative to
a guide \orange{or previously named set}. The user most specify the relative
orientation for the position as one of \texttt{left}, \texttt{right}, 
\texttt{above}, or \texttt{below}. These constraints are defined as:

\begin{definition}
Let $S$ be the set on which the constraint \texttt{position left of guide g} is applied.
For all nodes $n$ in $S$, we define a constraint such that $n[x]$ < $g[x]$.
\end{definition}

The user may optionally prove a \texttt{gap} that enforces additional spacing
between the nodes and identified guide. This property produces the following
definition:

\begin{definition}
Let $S$ be the set on which the constraint \texttt{position left of guide g with gap 20} is applied.
For all nodes $n$ in $S$, we define a constraint such that $(n[x]$ + 20) < $g[x]$.
\end{definition}

\emph{Implementation.}
Position constraints are one of the constraint types natively supported in
WebCoLa and also include a \texttt{gap} for the constraint. For each node
in set $S_1$, we produce one position constraint relative to the specified guide.
\orange{When the position constraint is defined relative to a named set $S_2$,
we produce one position constraint for each pair of nodes between $S_1$ and $S_2$.}

\emph{Rationale.} Position constraints allow the user to provide
overarching constraints relative to global elements such as guides. These
can be used to constrain the overall size of the graph or to section off
different areas.

%\jheer{Why only relative guides? Why can't relative position constraints be applied between sets?}
% \todo{This isn't implemented, but probably could be fairly easily. Orange above.}

%\todo{position constraints on set elements}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Order Constraints}
\constraint{\texttt{order} \emph{y} \texttt{axis} \texttt{by} \emph{``depth''}}
Order constraints enforce a sort order on the set elements. The user must 
specify the \texttt{axis} as either \texttt{x} or \texttt{y} and must define
the node property \texttt{by} which the order is determined. These 
constraints are defined as follows:

\begin{definition}
Let $S$ be the set on which the constraint \texttt{order x axis by node depth} is applied.
For all nodes $n_1$ and $n_2$ in $S$, we define a constraint such that $n_1[x]$ < $n_2[x]$
if $n_1[depth] < n_2[depth]$.
\end{definition}

The user can optionally define an explicit list of values for a custom
\texttt{order}; otherwise, the elements are ordered alphabetically \texttt{by}
the specified property. The user may also optionally include a boolean of whether
or not to \texttt{reverse} the order. Users may finally specify an optional
\texttt{band} property for the constraint that determines a size for each
set region. For the \texttt{band} property, users can introduce fixed spacing
to the order of the elements by introducing boundaries between elements.
Constraints with the \texttt{band} property are defined as follows:

\begin{definition}
Let $S$ be the set with $N$ elements on which the constraint 
\texttt{order x axis by node depth with band 200} is applied.
We define $N+1$ boundary guides: $b_1, b_2, ..., b_{N+1}$ where
$b_1[x] + 200 == b_2[x]$. We then sort the elements by the depth.
Let $n_1$ be the element with the smallest depth and $n_2$ be the element 
with the next smallest depth. We then produce constraints such that
$b_1[x] < n_1[x]$ and $n_1[x] < b_2[x]$ and $b_2[x] < n_2[x]$.
\end{definition}

\emph{Implementation}
We define order constraints by defining WebCoLa position constraints based
on the definitions defined above. \todo{Confirm definitions/implementation.}

%\jheer{Similar question as above regarding x/y vs. other possible options.}

\emph{Rationale.} Unlike position constraints, order constraints allow the
user to specify the overall sort order for the layout.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Circle Constraints}
\constraint{\texttt{circle} \texttt{around} \emph{``center''}}
Circle constraints allow the user to specify a ring layout for a set of
elements. The constraint must include which element the set elements should
be positioned around or may specify ``center'' for a generic center point
to be used.

\todo{Formal definition of this constraint?}

\jheer{I'm confused regarding the center. What is a generic center point? Can one specify a x,y point or related guide? What does it mean to put an element in the center? Does this constraint work with sets of sets?}

\emph{Implementation.}
Circle constraints are not a supported constraint type in WebCoLa. To 
demonstrate the utility of this constraint type we approximated the behavior
in our WebCoLa implementation. To do this, we first add a temporary node
to act as the center of the circle layout. We then add a link between each 
node in the set and the temporary center. \todo{Finish and confirm description of procedure.}

\todo{I've looked into two ways of approximating the circle procedure. 
(1) Add edges between each node in the circle and the center, and around
the circle edge. (2) Produce the layout with position constraints and 
then convert to polar coordinates.}

\emph{Rationale.} Circular structures are a common layout requirement of
existing strategies \todo{citation} and can be crucial for relating
properties of the underlying structure.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Cluster Constraints}
\constraint{\texttt{cluster}} 
Cluster constraints encourage a organic clustering of the nodes around
a center point.

\todo{Formal definition of this constraint?}

\emph{Implementation.}
Cluster constraints are not currently supported in WebCoLa. In order to
produce a clustered appearance, we add temporary edges between all nodes
in the set to produce a clique and require the edges to have shorter length.

\emph{Rationale.}
Cluster constraints do not have as strong an impact as alignment or
position constraints, but encourage the nodes to be attracted to one
another to produce a more inherent grouping than may otherwise occur.
This behavior is similar to many force-directed techniques in which
nodes are attracted to others of similar type.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Hull Constraints}
\constraint{\texttt{hull}} 
Hull constraints create a boundary around the set elements and prevents
elements from other sets from passing through this boundary. These 
constraints are defined as follows:

\begin{definition}
Let $S$ be the set on which the constraint \texttt{hull} is applied. We produce a
rectangle $B$ with properties $B.x1$, $B.x2$ $B.y1$, $B.y2$. For all nodes
$n$ in $S$, we define constraints such that $B.x1 < n[x]$, $n[x] < B.x2$,
$B.y1 < n[y]$, $n[y] < B.y2$. For all nodes $m$ \emph{not} in $S$, we define
constraints such that $m[x] < B[x1] || B[x2] < m[x]$ and $m[y] < B[y1] || B[y2] < m[x]$.
\end{definition}

\emph{Implementation.}
We generate hull constraints in WebCoLa using its built-in support for 
specifying \texttt{groups} in the layout which produce a boundary around 
the nodes defined by their \texttt{\_id}.

\emph{Rationale.}
Hull constraints allow users to create enclosed regions of the graph in
which the set elements do not interact with elements outside the set. This
type of constraint can prevent nodes from interleaving when they are part
of separate sets.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Padding Constraints}
\constraint{\texttt{padding 5}} 
Padding constraints introduce an amount of space around the element relative
to other elements in the set. These constraints are defined as follows:

\todo{Formal definition of this constraint?}

\emph{Implementation.}
Padding introduces additional space around nodes without constraining the
axis on which the padding is added. Our current implementation adds a
padding to the nodes which essentially increases the size of the element
when WebCoLa's non-overlap behavior is applied. However, in this implementation
padding can only be specified once and applies to all nodes, not just nodes
in the specified set. Future work is required to develop constraint that
respect the padding only relative to set elements.

\emph{Rationale.}
To support the overall legibility of the graph, additional padding can be
beneficial to ensure that nodes are not placed to close together.

\subsection{Creating Guides in WebCoLa}
\constraint{$O(g)$ new nodes}
In \projectname, the user may define guides to control the graph layout.
To use these guides in WebCoLa constraints, we add a new node to the graph
for each guide and generate constraints relative to this node. These 
temporary nodes are included in WebCoLa's layout but are hidden from the
final visualization of the graph layout.

\subsection{Application of Multiple Constraints}
\todo{Describe the interplay of different constraints for the specification.}
